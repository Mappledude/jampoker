rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // DEV: players are open until Auth is added.
    match /players/{playerId} {
      allow read, write: if true;
    }

    match /tables/{tableId} {
      allow read: if true;

      // Allow creating/deleting tables from Admin UI (dev phase).
      allow create, delete: if true;

      // Only allow client to change nextVariantId; everything else must stay the same.
      allow update: if request.resource.data.diff(resource.data).changedKeys().hasOnly(['nextVariantId']);
    }

    match /tables/{tableId}/seats/{playerId} {
      allow read: if true;

      // Join / Leave from client is okay; server manages chip counts afterwards.
      allow create, delete: if true;

      // Prevent clients from editing chip stacks, seatNum, etc.
      allow update: if false;
    }

    // Hands are server-managed only.
    match /tables/{tableId}/hands/{handId} {
      allow read: if true;
      allow write: if false;
    }
  }
}

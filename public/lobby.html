<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lobby</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <div class="wrap">
    <nav class="nav">
      <a href="/">Home</a>
      <a href="/lobby.html">Lobby</a>
      <a href="/admin.html">Admin</a>
    </nav>

    <div class="card">
      <h1>Lobby</h1>
      <p class="small">Showing ACTIVE tables. (Join flow coming soon.)</p>
      <div id="tables" class="small">Loading tables…</div>
    </div>
  </div>

  <script type="module" src="/firebase-init.js"></script>
  <script type="module">
    import { app } from "/firebase-init.js";
    import {
      getFirestore, collection, query, orderBy, onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    const db = getFirestore(app);
    const tablesCol = collection(db, "tables");
    const listEl = document.getElementById("tables");

    const dollars = (cents) =>
      `$${(cents/100).toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2})}`;

    const renderCard = (d) => {
      const blindStr = `${dollars(d.smallBlindCents || 0)}/${dollars(d.bigBlindCents || 0)}`;
      const rangeStr = `${dollars(d.minBuyInCents || 0)}–${dollars(d.maxBuyInCents || 0)} (default ${dollars(d.defaultBuyInCents || 0)})`;
      return `
        <div style="margin-top:12px;padding:14px;border:1px solid #334155;border-radius:12px;background:#111827">
          <div style="font-weight:700">${d.name || "(no name)"}</div>
          <div class="small">Blinds: ${blindStr}</div>
          <div class="small">Buy-in: ${rangeStr}</div>
          <div style="margin-top:8px;">
            <button disabled title="Join flow coming soon" style="opacity:.6;cursor:not-allowed;padding:8px 12px;border-radius:10px;border:1px solid #334155;background:#0ea5e9;color:white;font-weight:700;">Join (coming soon)</button>
          </div>
        </div>
      `;
    };

    const q = query(tablesCol, orderBy("createdAt", "desc"));
    onSnapshot(q, (snap) => {
      const rows = [];
      snap.forEach(docSnap => {
        const d = docSnap.data();
        if (d.active) rows.push(renderCard(d));
      });
      listEl.innerHTML = rows.length ? rows.join("") : "No active tables.";
    });
  </script>
</body>
</html>
